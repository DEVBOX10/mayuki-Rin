name: Build-Development

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 3.0.100
    - uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 2.2.402
    - name: "Rin.Frontend: build & pack"
      working-directory: src/Rin.Frontend
      run: |
        yarn
        yarn run build
        yarn run pack
    - name: "Rin.Mvc.Frontend: build"
      working-directory: src/Rin.Mvc.Frontend
      run: |
        yarn
        yarn run build
    - name: Copy Rin.Mvc.Frontend
      run: |
        mkdir -p src/Rin.Mvc/EmbeddedResources/
        cp -R src/Rin.Mvc.Frontend/dist/static/* src/Rin.Mvc/EmbeddedResources/
    - name: "dotnet build & pack"
      run: |
        dotnet restore
        dotnet build -c Release
        dotnet pack -c Release -o $GITHUB_WORKSPACE/artifacts --version-suffix preview.`date +%Y%m%d%H%M%S`
    - uses: actions/upload-artifact@master
      with:
        name: Packages
        path: artifacts
